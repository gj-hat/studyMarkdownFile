# 操作系统



## 01_准备

在线平台:

+ uCore操作系统上做实验
+ `Https://github.com/chyyuu/mooc_ox_lab`



## 02_什么是操作系统

1. 操作系统层次架构

   介于: 硬件和应用程序之间的部分

2. 软件层次按照接口区分

   1. Shell(外壳): Linux Windows Android的界面等由系统向软件提供服务接口
   2. Kernel(内核): 在Shell之下的部分, 用于硬件和系统间的接口

### 2.1 操作系统内部组件

1. CPU调度

   进程, 线程….

2. 物理内存管理

   物理内存的管理

3. 虚拟内存管理

   给上次应用提供一块尽可能大的虚拟空间,供软件进行独立使用

4. 文件系统管理  底层是Disk在操作系统中抽象为文件系统

   Disk:计算机组成原理中,物理内存的单位是块, 交给操作系统管理后, 对用户以文件为单位呈现

5. 中断处理和设备驱动

   网卡声卡显卡 ……



### 2.2 OS Kernel的特征

1. 并发, 并行

   + 在一段时间中, 多个程序在不同时间内同时运行, 需要OS进行管理和调度

   + 一个时间点内,多个程序运行(依赖于多核心)

2. 共享

   将计算机的资源(IO, 内存, 硬盘等资源), 由多个应用程序共同使用

   由操作系统进行资源管理,这些应用程序如何“同时”享用这些资源

   + 互斥共享     分时共享
   + “同时”访问:  由操作系统对系统资源进行虚拟化  每个应用程序使用不同的资源

3. 虚拟

   操作系统会将各种各样的系统资源进行虚拟化,例如: 

   + CPU  ——–  进程
   + 磁盘  ——–  文件 
   + 内存  ——–  地址空间

   使得每一个应用程序或者用户同时享用资源

4. 异步

   程序在操作系统中大多数情况下不是一贯到底的, 而是走走停停, 向前推荐的速度是不可预知的

   但只要运行环境相同, os需要保证程序输出的结果是相同的. (软件每次运行前的环境相同时, 其结果也应该是相同的)



## 03_为什么学习操作系统



……

CPU调度上产生的有意思的问题: 例如多线程的结果



站在更高层次看:

操作系统需要权衡一些:

1. 空间与时间
2. 性能和可预测性
3. 公平和性能



硬件方面 操作系统需要的事情

1. 良好的硬件管理
2. 合理的资源分配
3. 例如 硬盘 内存 缓存 处理器之间速度差异的协调处理

 

插一句:

紧耦合:  函数调用方式

松耦合:  消息调用方式实现



## 04_系统结构

紧耦合的形式(主流):

内核非常庞大, 编码复杂耦合程度高, 但是效率比微内核架构好很多



微内核松耦合的方式

io 并发 中断等等分模块进行开发

微内核就是将这些模块作为单独的模块进行开发

内核中只存放一些基础的东西就使得内核的大小非常小. 例如

+ 内核: 存放:中断 消息传递….

+ 外围: 文件系统 网络协议  内存管理, 以进程或者说服务的形式存在,  服务和服务之间通过内核进行消息传递连接 

代价就是性能上进行一定程度的折损



学术界有更为极端的一种设计:

内外核机制

外核 用作操作系统和硬进行交互 (复制)

内核  用于应用程序和操作系统资源的交互



虚拟机监控器 VMM

类似于上述三,  运行在传统的OS之下   目前主要用于虚拟机和监控机等

传统结构:  操作系统之下就是硬件    虚拟机监控器结构, 操作系统之下是VMM,再之下才是硬件  

在一台物理机上将资源虚拟为多个机器, 以供上层操作系统进行使用

 VMM将单独的机器接口转化为多个幻象, 这些接口(虚拟机)是一个原始计算机的有效副本, 并完成所有的处理器指令,使得上层操作系统感知不到其实允许在虚拟机只上的



https://www.bilibili.com/video/BV1wq4y1M7qf?p=9